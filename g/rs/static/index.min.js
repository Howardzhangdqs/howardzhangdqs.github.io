let isDesktop=!navigator.userAgent.match(/(ipad|iphone|ipod|android|windows phone)/i),fontunit=isDesktop?20:(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth)/320*10;document.write('<style type="text/css">html,body {font-size:'+(fontunit<30?fontunit:"30")+"px;}"+(isDesktop?"#welcome,#GameTimeLayer,#GameLayerBG,#GameScoreLayer.SHADE{position: absolute;}":"#welcome,#GameTimeLayer,#GameLayerBG,#GameScoreLayer.SHADE{position:fixed;}@media screen and (orientation:landscape) {#landscape {display: box; display: -webkit-box; display: -moz-box; display: -ms-flexbox;}}")+"</style>");var chart_option={},pre_click_time=+new Date,min_click_time=1e7;let tscore_list=[];texture=texture1;let slinec={sline1:!0,sline2:!0,sline3:!0,sline4:!0};var score_list=[0];let l_gameScore=0;get_score_list=function(){score_list.push(_gameScore-l_gameScore),l_gameScore=_gameScore},sline=function(e){sline_mode&&(slinec["sline"+e]=!slinec["sline"+e],slinec["sline"+e]?$("#sline"+e).css("background-color","#fff"):$("#sline"+e).css("background-color","#AAA"),check_sline_full()?($("#sline_text").css("color","red"),$("#sline_text").text("请勿ban掉所有的列"),slinec["sline"+e]=!slinec["sline"+e],slinec["sline"+e]?$("#sline"+e).css("background-color","#fff"):$("#sline"+e).css("background-color","#AAA")):($("#sline_text").css("color","black"),$("#sline_text").text("请点击需要ban掉的列")))},check_sline_full=function(){for(let e=1;e<=4;e++)if(slinec["sline"+e])return!1;return!0},sline_mode_f=function(){$("#sline_mode").is(":checked")?(sline_mode=!0,$("#sline").css("display","flex"),$("#basic-addon11").css("border-radius",".25rem 0 0 0"),$("#sline_text").text("请点击需要ban掉的列")):($("#sline").css("display","none"),$("#basic-addon11").css("border-radius",".25rem 0 0 .25rem"),$("#sline_text").text("畅享丝滑"),sline_mode=!1,$("#sline1, #sline2, #sline3, #sline4").css("background-color","#fff"),slinec={sline1:!0,sline2:!0,sline3:!0,sline4:!0})},cheat_mode_f=function(){$("#cheat_mode").is(":checked")?($(".cheat").css("display","flex"),$("#cheat_text").text("你也算是是抬举的人了"),cheat_mode=!0):($(".cheat").css("display","none"),$("#cheat_text").text("给你机会你不中用啊"),cheat_mode=!1)},strToJson=function(e){return new Function("return "+e)()},customize=function(){let e;$("#texture-addon1").css("color","green"),$("#texture-addon1").text("格式正确");try{e=strToJson($("#customized").val())}catch{return console.log("配置项读取错误"),$("#texture-addon1").css("color","red"),void $("#texture-addon1").text("格式错误")}if(console.log("读取到配置项："+JSON.stringify(e)),"object"!=typeof e)return console.log("请确保配置项格式正确"),$("#texture-addon1").css("color","red"),void $("#texture-addon1").text("格式错误");console.log("正在解析配置项"),$("#texture-addon1").css("color","green"),$("#texture-addon1").text("格式正确"),init_texture(e)},changetexture=function(){let e=parseInt($("#select option:selected").val());$("#customize").css("display","none"),0==e?texture=texture0:1==e?texture=texture1:2==e?texture=texture2:3==e&&$("#customize").css("display","flex"),init_texture(texture),customize()},init_texture=function(e){var t=$("#texture_bc"),n=$("#texture_ac");if(t.html(construct_texture(e)),n.html(construct_texture(e,"aimg","t")),gameInit(e),e.hasOwnProperty("idtext"))for(let t in e.idtext)$("#"+t).html(e.idtext[t])},construct_texture=function(e,t="bimg",n=""){let o=0,a="";for(let i=0;i<=39;i++){let r='div[num="'+i+'"].'+n;a+=r+"t1, "+r+"t2, "+r+"t3, "+r+"t4, "+r+"t5{background-image: url("+e[t][o]+");}\n",++o>=e[t].length&&(o=0)}return a},$((function(){$("#select").val("1"),init_texture(texture1),gaming_time=2e3,_gameTimeNum=gaming_time,GameTimeLayer.innerHTML=creatTimeText(_gameTimeNum)}));let map={d:1,f:2,j:3,k:4};isDesktop&&(document.write('<div id="gameBody">'),document.onkeydown=function(e){let t=e.key.toLowerCase();-1!==Object.keys(map).indexOf(t)&&click(map[t])});let body,blockSize,GameLayer=[],GameLayerBG,touchArea=[],GameTimeLayer,transform,transitionDuration,refreshSizeTime;function init(){showWelcomeLayer(),body=document.getElementById("gameBody")||document.body,body.style.height=window.innerHeight+"px",transform=void 0!==body.style.webkitTransform?"webkitTransform":void 0!==body.style.msTransform?"msTransform":"transform",transitionDuration=transform.replace(/ransform/g,"ransitionDuration"),GameTimeLayer=document.getElementById("GameTimeLayer"),GameLayer.push(document.getElementById("GameLayer1")),GameLayer[0].children=GameLayer[0].querySelectorAll("div"),GameLayer.push(document.getElementById("GameLayer2")),GameLayer[1].children=GameLayer[1].querySelectorAll("div"),GameLayerBG=document.getElementById("GameLayerBG"),null===GameLayerBG.ontouchstart?GameLayerBG.ontouchstart=gameTapEvent:GameLayerBG.onmousedown=gameTapEvent,gameInit(texture),initSetting(),window.addEventListener("resize",refreshSize,!1);let e=document.getElementById("ready-btn");e.className="btn btn-primary btn-lg",e.onclick=function(){closeWelcomeLayer()}}function winOpen(){window.open(location.href+"?r="+Math.random(),"nWin","height=500,width=320,toolbar=no,menubar=no,scrollbars=no");let e=window.open("about:blank","_self");e.opener=null,e.close()}function refreshSize(){clearTimeout(refreshSizeTime),refreshSizeTime=setTimeout(_refreshSize,200)}function _refreshSize(){countBlockSize();for(let e=0;e<GameLayer.length;e++){let t=GameLayer[e];for(let e=0;e<t.children.length;e++){let n=t.children[e].style;n.left=e%4*blockSize+"px",n.bottom=Math.floor(e/4)*blockSize+"px",n.width=blockSize+"px",n.height=blockSize+"px"}}let e,t;GameLayer[0].y>GameLayer[1].y?(e=GameLayer[0],t=GameLayer[1]):(e=GameLayer[1],t=GameLayer[0]);let n=_gameBBListIndex%10*blockSize;e.y=n,e.style[transform]="translate3D(0,"+e.y+"px,0)",t.y=-blockSize*Math.floor(e.children.length/4)+n,t.style[transform]="translate3D(0,"+t.y+"px,0)"}function countBlockSize(){blockSize=body.offsetWidth/4,body.style.height=window.innerHeight+"px",GameLayerBG.style.height=window.innerHeight+"px",touchArea[0]=window.innerHeight-0*blockSize,touchArea[1]=window.innerHeight-3*blockSize}invincible__mode=(invincible__mode|invincible_mode)&cheat_mode;let _gameBBList=[],_gameBBListIndex=0,_gameOver=!1,_gameStart=!1,_gameTime,_gameTimeNum,_gameScore,_date1,deviation_time;function gameInit(e){createjs.Sound.registerSound({src:e.sound[0],id:"err"}),createjs.Sound.registerSound({src:e.sound[1],id:"end"}),createjs.Sound.registerSound({src:e.sound[2],id:"tap"}),gameRestart()}function gameRestart(){_gameBBList=[],_gameBBListIndex=0,_gameScore=0,_gameOver=!1,_gameStart=!1,_gameTimeNum=gaming_time,GameTimeLayer.innerHTML=creatTimeText(_gameTimeNum),countBlockSize(),refreshGameLayer(GameLayer[0]),refreshGameLayer(GameLayer[1],1),gaming_time=100*parseInt($("#gaming-time").val())}function gameStart(){_date1=new Date,_gameStart=!0,_gameTime=setInterval(gameTime,10),score_list=[0],l_gameScore=0}function gameOver(e=!1){opportunity_mode&&cheat_mode?(e&&(_gameOver=!0),e&&(clearInterval(_gameTime),Deal_aftermath1()),setTimeout((function(){e&&(GameLayerBG.className=""),e&&showGameScoreLayer(),$(".bad").removeClass("bad"),Deal_aftermath2()}),100)):(_gameOver=!0,clearInterval(_gameTime),Deal_aftermath1(),setTimeout((function(){GameLayerBG.className="",showGameScoreLayer(),Deal_aftermath2()}),800))}function encrypt(e){let t=new JSEncrypt;return t.setPublicKey("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDTzGwX6FVKc7rDiyF3H+jKpBlRCV4jOiJ4JR33qZPVXx8ahW6brdBF9H1vdHBAyO6AeYBumKIyunXP9xzvs1qJdRNhNoVwHCwGDu7TA+U4M7G9FArDG0Y6k4LbS0Ks9zeRBMiWkW53yQlPshhtOxXCuZZOMLqk1vEvTCODYYqX5QIDAQAB"),t.encrypt(e)}function SubmitResults(){let e="其他操作系统",t="异世界";if(document.getElementById("username").value){-1!=navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(e="Macintosh"),-1!=navigator.appVersion.indexOf("Linux")&&(e="Linux"),-1!=navigator.appVersion.indexOf("Android")&&(e="Android"),-1!=navigator.appVersion.indexOf("like Mac")&&(e="iOS"),returnCitySN.cname&&(t=returnCitySN.cname);let n=new XMLHttpRequest;n.open("POST","./SubmitResults.php",!0),n.setRequestHeader("Content-type","application/json");let o=document.getElementById("username").value,a=document.getElementById("message").value,i="|_|";n.send(encrypt(_gameScore+i+o+i+tj+i+e+i+t+i+a))}}function gameTime(){_gameTimeNum-=1,_gameTimeNum%100==0&&get_score_list(),_gameTimeNum<=0?(GameTimeLayer.innerHTML="&nbsp;时间到！",gameOver(!0),GameLayerBG.className+=" flash",createjs.Sound.play("end")):GameTimeLayer.innerHTML=creatTimeText(_gameTimeNum)}function creatTimeText(e){return"剩余时间:"+(""+Math.floor(e/100)).padStart(2,0)+"'"+(""+Math.floor(e%100)).padStart(2,0)+'"'}Deal_aftermath1=function(){for(get_score_list(),console.log(score_list);score_list.length>parseInt($("#gaming-time").val())+1;)score_list[$("#gaming-time").val()]+=score_list.pop(),console.log("length over "+$("#gaming-time").val()),console.log(score_list)},Deal_aftermath2=function(){if(1e7==min_click_time)$("#GameScoreLayer-fastest").css("display","none");else{let e=document.getElementById("mainchart");for(let e=1;e<=score_list.length;e++)tscore_list.push(score_list[e]);chart_option={grid:{left:"0%",bottom:"0%",width:"100%",height:"100%",containLabel:!0},tooltip:{},legend:{show:!1},xAxis:{type:"category",min:1,max:score_list.length-1},yAxis:{type:"value"},series:[{name:"每秒点击量",type:"bar",data:score_list}]},console.log(e.clientWidth||e.offsetWidth),console.log(e.clientHeight||e.offsetHeight),echarts.init(e).setOption(chart_option),console.log(min_click_time),$("#GameScoreLayer-fastest").css("display","block"),$("#GameScoreLayer-fastest").text("最快点击速度"+(1e3/min_click_time).toFixed(3)+"次/秒"),$("#GameScoreLayer-average").text("平均点击速度"+(1e3/((100*parseInt($("#gaming-time").val())-_gameTimeNum)/_gameScore*10)).toFixed(3)+"次/秒")}min_click_time=1e7};let _ttreg=/ t{1,2}(\d+)/,_clearttClsReg=/ t{1,2}\d+| bad/;function refreshGameLayer(e,t,n){let o=get_i(0)+(t?0:4);for(let t=0;t<e.children.length;t++){let n=t,a=(Math.floor(t/4),e.children[n]),i=a.style;if(i.left=n%4*blockSize+"px",i.bottom=Math.floor(n/4)*blockSize+"px",i.width=blockSize+"px",i.height=blockSize+"px",a.className=a.className.replace(_clearttClsReg,""),o==n){_gameBBList.push({cell:o%4,id:a.id});let e=Math.floor(1e3*Math.random())%1+1;a.className+=" t"+e,a.notEmpty=!0,o=get_i(t)+4*(Math.floor(n/4)+1)}else a.notEmpty=!1}t?(e.style.webkitTransitionDuration="0ms",e.style.display="none",e.y=-blockSize*(Math.floor(e.children.length/4)+(n||0))*t,setTimeout((function(){e.style[transform]="translate3D(0,"+e.y+"px,0)",setTimeout((function(){e.style.display="block"}),100)}),200)):(e.y=0,e.style[transform]="translate3D(0,"+e.y+"px,0)"),e.style[transitionDuration]="150ms"}function gameLayerMoveNextRow(){for(let e=0;e<GameLayer.length;e++){let t=GameLayer[e];t.y+=blockSize,t.y>blockSize*Math.floor(t.children.length/4)?refreshGameLayer(t,1,-1):t.style[transform]="translate3D(0,"+t.y+"px,0)"}}function gameTapEvent(e){console.log("click");let t=+new Date;if(min_click_time=Math.min(min_click_time,t-pre_click_time),pre_click_time=t,_gameOver)return!1;let n=e.target,o=e.clientY||e.targetTouches[0].clientY,a=(e.clientX||e.targetTouches[0].clientX)-body.offsetLeft,i=_gameBBList[_gameBBListIndex];return o>touchArea[0]||o<touchArea[1]||(i.id==n.id&&n.notEmpty||0==i.cell&&a<blockSize||1==i.cell&&a>blockSize&&a<2*blockSize||2==i.cell&&a>2*blockSize&&a<3*blockSize||3==i.cell&&a>3*blockSize||invincible__mode?(_gameStart||gameStart(),createjs.Sound.play("tap"),n=document.getElementById(i.id),n.className=n.className.replace(_ttreg," tt$1"),_gameBBListIndex++,_gameScore++,gameLayerMoveNextRow()):_gameStart&&!n.notEmpty&&(createjs.Sound.play("err"),gameOver(),n.className+=" bad")),!1}function createGameLayer(){let e='<div id="GameLayerBG">';for(let t=1;t<=2;t++){let n="GameLayer"+t;e+='<div id="'+n+'" class="GameLayer">';for(let t=0;t<10;t++)for(let o=0;o<4;o++)e+='<div id="'+n+"-"+(o+4*t)+'" num="'+(o+4*t)+'" class="block'+(o?" bl":"")+'"></div>';e+="</div>"}return e+="</div>",e+='<div id="GameTimeLayer"></div>',e}function closeWelcomeLayer(){document.getElementById("welcome").style.display="none"}function showWelcomeLayer(){document.getElementById("welcome").style.display="block"}function showGameScoreLayer(){let e=document.getElementById("GameScoreLayer"),t=document.getElementById(_gameBBList[_gameBBListIndex-1].id).className.match(_ttreg)[1];e.className=e.className.replace(/bgc\d/,"bgc"+t),document.getElementById("GameScoreLayer-text").innerHTML=shareText(_gameScore);let n="得分&nbsp;&nbsp;";n+=deviation_time<23e3?_gameScore:"<span style='color:red;'>"+_gameScore+"</span>",document.getElementById("GameScoreLayer-score").innerHTML=n;let o=cookie("bast-score");deviation_time<23e3&&(!o||_gameScore>o)&&(o=_gameScore,cookie("bast-score",o,100)),document.getElementById("GameScoreLayer-bast").innerHTML="最佳&nbsp;&nbsp;"+o,e.style.display="block"}function hideGameScoreLayer(){document.getElementById("GameScoreLayer").style.display="none"}function replayBtn(){gameRestart(),hideGameScoreLayer()}function backBtn(){gameRestart(),hideGameScoreLayer(),showWelcomeLayer()}function shareText(e){let t=new Date;if(deviation_time=t.getTime()-_date1.getTime(),deviation_time=10,deviation_time>23e3)return"倒计时多了"+(deviation_time/1e3-20).toFixed(2)+"s";SubmitResults();for(let t=0;t<texture.score.length;t++)if(e<texture.score[t]*parseInt($("#gaming-time").val()))return texture.text[t];return texture.text[texture.score.length]}function toStr(e){return"object"==typeof e?JSON.stringify(e):e}function cookie(name,value,time){if(name){if(value){if(time){let e=new Date;e.setTime(e.getTime()+864e5*time),time=e.toGMTString()}return document.cookie=name+"="+escape(toStr(value))+(time?"; expires="+time+(arguments[3]?"; domain="+arguments[3]+(arguments[4]?"; path="+arguments[4]+(arguments[5]?"; secure":""):""):""):""),!0}return value=document.cookie.match("(?:^|;)\\s*"+name.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")+"=([^;]*)"),value=!(!value||"string"!=typeof value[1])&&unescape(value[1]),(/^(\{|\[).+\}|\]$/.test(value)||/^[0-9]+$/g.test(value))&&eval("value="+value),value}let data={};value=document.cookie.replace(/\s/g,"").split(";");for(let e=0;value.length>e;e++)name=value[e].split("="),name[1]&&(data[name[0]]=unescape(name[1]));return data}function initSetting(){document.getElementById("username").value=cookie("username")?cookie("username"):"",document.getElementById("message").value=cookie("message")?cookie("message"):"",cookie("keyboard")&&(document.getElementById("keyboard").value=cookie("keyboard"),map={},map[cookie("keyboard").charAt(0).toLowerCase()]=1,map[cookie("keyboard").charAt(1).toLowerCase()]=2,map[cookie("keyboard").charAt(2).toLowerCase()]=3,map[cookie("keyboard").charAt(3).toLowerCase()]=4)}function show_btn(){$("#opportunity_mode").is(":checked")?opportunity_mode=!0:opportunity_mode=!1,$("#invincible_mode").is(":checked")?(invincible_mode=!0,invincible__mode=!0):(invincible_mode=!1,invincible__mode=!1),gaming_time=100*parseInt($("#gaming-time").val()),document.getElementById("btn_group").style.display="block",document.getElementById("setting").style.display="none",gameRestart()}function show_setting(){document.getElementById("btn_group").style.display="none",document.getElementById("setting").style.display="block"}function save_cookie(){cookie("username",document.getElementById("username").value,100),cookie("message",document.getElementById("message").value,100),cookie("keyboard",document.getElementById("keyboard").value,100),initSetting()}function isnull(e){let t=e.replace(/(^\s*)|(\s*$)/g,"");return""==t||null==t||null==t}function goRank(){let e=document.getElementById("username").value,t="./rank.php";isnull(e)||(t+="?name="+e),window.location.href=t}function click(e){let t=_gameBBList[_gameBBListIndex],n=parseInt(document.getElementById(t.id).getAttribute("num"))-t.cell+e-1,o=t.id.substring(0,11)+n;gameTapEvent({clientX:((e-1)*blockSize+e*blockSize)/2+body.offsetLeft,clientY:(touchArea[0]+touchArea[1])/2,target:document.getElementById(o)})}get_i=function(e){if(texture.hasOwnProperty("formatter"))return texture.formatter(e);let t=Math.floor(1e3*Math.random())%4;if(!sline_mode)return t;for(;!slinec["sline"+(t+1)];)t=Math.floor(1e3*Math.random())%4;return t},document.write(createGameLayer()),show_setting_in_the_middle=function(){gameRestart(),showWelcomeLayer(),document.getElementById("GameScoreLayer").style.display="none",show_setting()},console.log("不修改，好嘛？乱传又有什么用呢？(ˉ▽ˉ；)..."),console.log(""),console.log("上面那句话是原作者写的，我觉得写的不错就留着了"),console.log("很高兴您会按下%cF12%c并且会%c打开console%c","color:#00f","color:#000","color:#f00","color:#000"),console.log("原作者的开源地址在这里：%chttps://github.com/Xiaohuang257/RapeSenpai%c","color:#00f","color:#000"),console.log("顺便吐槽一句：%c原作者的代码写的真太TM好了","font-size:30px;color:#f00;font-weight:bold"),console.log("还有下面的那些报错不用管，程序可以正常运行");